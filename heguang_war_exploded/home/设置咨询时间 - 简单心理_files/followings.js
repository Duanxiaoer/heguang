"use strict";riot.tag2("followings",'<div class="filter-box j-search-bar"><img src="http://jdxl-img.b0.upaiyun.com/uploads/d2e2cb06aa8940dabe16c989ef9137f5.png"><input class="following-filter" type="search" placeholder="搜索来访者ID或名字" onkeyup="{{filter}}"></div><p class="loading" if="{{data.loading}}">正在加载...</p><span class="none">没有搜到相应来访</span><table class="following-table"><tr class="section" if="{{data.ongoings.length &gt; 0}}"><td colspan="2">进行中 ({{ data.ongoings.length }})</td></tr><tr class="user" each="{{following, index in data.ongoings}}" data-key="{{following.attributes.from_user_id}} {{following.attributes.from_user_name}}"><td><a href="{{following.attributes.path}}">{{\'#\' + following.attributes.from_user_id.toString() + \'&nbsp;&nbsp;\' + following.attributes.from_user_name.toString()}}</a><br><span>{{following.attributes.counselings_count}}次</span></td><td><div class="title">{{following.attributes.next_counseling_time_humanize}}</div></td></tr><tr class="section" if="{{data.olds.length &gt; 0}}"><td colspan="2">四周未续约 ({{ data.olds.length }})</td></tr><tr class="user" each="{{following, index in data.olds}}" data-key="{{following.attributes.from_user_id}} {{following.attributes.from_user_name}}"><td><a href="{{following.attributes.path}}">{{\'#\' + following.attributes.from_user_id.toString() + \'&nbsp;&nbsp;\' + following.attributes.from_user_name.toString()}}</a><br><span>{{following.attributes.counselings_count}}次</span></td><td><div class="title">{{following.attributes.next_counseling_time_humanize}}</div></td></tr><tr class="section" if="{{data.ended.length &gt; 0}}"><td colspan="2">已结束 ({{ data.ended.length }})</td></tr><tr class="user" each="{{following, index in data.ended}}" data-key="{{following.attributes.from_user_id}} {{following.attributes.from_user_name}}"><td><a href="{{following.attributes.path}}">{{\'#\' + following.attributes.from_user_id.toString() + \'&nbsp;&nbsp;\' + following.attributes.from_user_name.toString()}}</a><br><span>{{following.attributes.counselings_count}}次</span></td><td><div class="title">{{following.attributes.next_counseling_time_humanize}}</div></td></tr></table>','followings .filter-box,[data-is="followings"] .filter-box{ margin-top: 20px } followings .none,[data-is="followings"] .none{ display: none; margin: 20px 0 0 0; color: #6B707F; font-size: 14px; } followings p.loading,[data-is="followings"] p.loading{ text-align: center; } followings input.following-filter,[data-is="followings"] input.following-filter{ border-radius: 30px; border: none; box-shadow: none; background: #F7F8FC; padding: 4px 10px; color: #6B707F; } followings table,[data-is="followings"] table{ border-collapse:collapse; border: none; } followings .following-table,[data-is="followings"] .following-table{} followings table tr td:first-child,[data-is="followings"] table tr td:first-child{ width: 55%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; } followings tr td,[data-is="followings"] tr td{ padding: 8px 0; min-height: 36px } followings tr.section,[data-is="followings"] tr.section{ border: none; background-color: #fff; } followings tr.section td,[data-is="followings"] tr.section td{ font-size: 16px; color: #40434C; padding: 15px 0 0 0; } followings tbody,[data-is="followings"] tbody{ background: white; }',"",function(t){var i=this;i.data={};var s=i.data;s.loading=!0,s.params=null,s.ongoings=[],s.olds=[],s.ended=[],riot.restful(i,s,{model_name:["following","followings"],actions:["index"]}),i.filter=function(t){var o=$(t.currentTarget).val(),n=$(".following-table");return""!=o?(n.find("tr[data-key]").css("display","none"),n.find("tr[data-key*="+o+"]").css("display",""),$("tr.user:visible").length<1?(n.find(".section").css("display","none"),$(".followings .none").css("display","block")):(n.find(".section").css("display","block"),$(".followings .none").css("display","none"))):(n.find(".section").css("display",""),$(".followings .none").css("display","none"),n.find("tr[data-key]").css("display",""))},i.findNext=function(t){var o=s.sorted.indexOf(t);return o==s.sorted.length-1?-1:s.sorted[o+1].id},i.findPrev=function(t){var o=s.sorted.indexOf(t);return 0==o?-1:s.sorted[o-1].id},i.followings_loaded_done=function(t){s.loading=!1;var n=[];$.each(t.data,function(t,o){3!=o.attributes.status?null!=o.attributes.next_counseling_time?s.ongoings.push(o):o.attributes.old_than_4_weeks?o.attributes.old_than_4_weeks&&s.olds.push(o):n.push(o):s.ended.push(o)}),s.ongoings.sort(function(t,o){return t.attributes.next_counseling_time-o.attributes.next_counseling_time});var o=function(t,o){return t.attributes.counselings_count>o.attributes.counselings_count?-1:t.attributes.counselings_count==o.attributes.counselings_count?t.attributes.from_user_id-o.attributes.from_user_id:1};n.sort(o),s.ongoings=s.ongoings.concat(n),s.olds.sort(o),s.ended.sort(o),s.followings_next_link=null,s.followings_loading=!1,i.update()},i.on("before-mount",function(){riot.fetch_cache(i)}),i.on("mount",function(){s.fetched_cache||Api.get("followings").done(i.followings_loaded_done)})});